#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#define TABLE_SIZE 10

typedef struct {
    char name[30];
    char phone[15];
} Client;

Client hashTable[TABLE_SIZE];
int occupied[TABLE_SIZE]; 
int method = 1; 

int hash1(char* name) {
    int sum = 0;
    int i;
    for (i = 0; name[i] != '\0'; i++)
        sum += name[i];
    return sum % TABLE_SIZE;
}

int hash2(char* name) {
    int sum = 0;
	int i;
    for (i = 0; name[i] != '\0'; i++)
        sum += name[i];
    return 7 - (sum % 7); 
}

void insertLinear(char* name, char* phone) {
    int idx = hash1(name);
    int original = idx;
    while (occupied[idx]) {
        idx = (idx + 1) % TABLE_SIZE;
        if (idx == original) {
            printf("Hash Table is Full!\n");
            return;
        }
    }
    strcpy(hashTable[idx].name, name);
    strcpy(hashTable[idx].phone, phone);
    occupied[idx] = 1;
}

void insertQuadratic(char* name, char* phone) {
    int idx = hash1(name);
    int i = 1;
    while (occupied[idx]) {
        idx = (idx + i * i) % TABLE_SIZE;
        i++;
        if (i == TABLE_SIZE) {
            printf("Hash Table is Full!\n");
            return;
        }
    }
    strcpy(hashTable[idx].name, name);
    strcpy(hashTable[idx].phone, phone);
    occupied[idx] = 1;
}

void insertDoubleHash(char* name, char* phone) {
    int idx1 = hash1(name);
    int idx2 = hash2(name);
    int i = 0;
    int idx = idx1;
    while (occupied[idx]) {
        i++;
        idx = (idx1 + i * idx2) % TABLE_SIZE;
        if (i == TABLE_SIZE) {
            printf("Hash Table is Full!\n");
            return;
        }
    }
    strcpy(hashTable[idx].name, name);
    strcpy(hashTable[idx].phone, phone);
    occupied[idx] = 1;
}

void search(char* name) {
    int idx1 = hash1(name);
    int idx2 = (method == 3) ? hash2(name) : 1;
    int i = 0;
    while (i < TABLE_SIZE) {
        int idx;
        if (method == 1) {
            idx = (idx1 + i) % TABLE_SIZE; 
        } else if (method == 2) {
            idx = (idx1 + i * i) % TABLE_SIZE; 
        } else {
            idx = (idx1 + i * idx2) % TABLE_SIZE; 
        }
        if (occupied[idx] && strcmp(hashTable[idx].name, name) == 0) {
            printf("Found: %s -> %s\n", hashTable[idx].name, hashTable[idx].phone);
            return;
        }
        i++;
    }
    printf("Client not found!\n");
}

void displayHashTable() {
    printf("\nHash Table:\n");
    int i;
    for ( i = 0; i < TABLE_SIZE; i++) {
        if (occupied[i])
            printf("[%d] %s -> %s\n", i, hashTable[i].name, hashTable[i].phone);
        else
            printf("[%d] ---\n", i);
    }
}

int main() {
    int choice;
    char name[30], phone[15];
    
    int i;
    for (i = 0; i < TABLE_SIZE; i++) {
        occupied[i] = 0;
    }

    printf("Choose Collision Handling Method:\n");
    printf("1. Linear Probing\n");
    printf("2. Quadratic Probing\n");
    printf("3. Double Hashing\n");
    printf("Enter your choice: ");
    scanf("%d", &choice);
    method = choice;

    int n;
    printf("Enter number of clients to insert: ");
    scanf("%d", &n);
    
    for (i = 0; i < n; i++) {
        printf("\nEnter name: ");
        scanf("%s", name);
        printf("Enter phone number: ");
        scanf("%s", phone);

        switch (choice) {
            case 1:
                insertLinear(name, phone);
                break;
            case 2:
                insertQuadratic(name, phone);
                break;
            case 3:
                insertDoubleHash(name, phone);
                break;
            default:
                printf("Invalid choice!\n");
                return 1;
        }
    }

    displayHashTable();

    printf("\nSearch Client by Name: ");
    scanf("%s", name);
    search(name);

    return 0;
}
